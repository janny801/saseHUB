<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Your Profile - SASE UH</title>
  <link rel="stylesheet" href="style.css" />


<style>
  body {
    background-color: #0b0c10;
    font-family: "Trebuchet MS", sans-serif;
    color: #f5f5f5;
    margin: 0;
    padding: 40px 20px;
  }


  /* ===== Header Layout ===== */
.simple-header {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px 20px;
  border-bottom: 2px solid #70c041;
  position: relative;
}

/* Aligns header-right content vertically */
.header-right {
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* Logo style */
.sase-logo {
  height: 60px;
  width: auto;
  margin-bottom: 10px;
}

/* Header title color & sizing */
.simple-header h1 {
  color: #70c041;
  font-size: 2em;
  margin: 0;
  font-weight: 700;
}

/* ===== Dropdown Menu + Hamburger ===== */
.menu-container {
  position: absolute;
  top: 20px;
  right: 20px;
}

.hamburger {
  background-color: #70c041;
  color: #0b0c10;
  border: none;
  padding: 10px 18px;
  border-radius: 6px;
  font-size: 1.1em;
  cursor: pointer;
  font-weight: bold;
}

.dropdown {
  display: none;
  position: absolute;
  right: 0;
  margin-top: 10px;
  background-color: #132235;
  border: 1px solid #70c041;
  border-radius: 6px;
  min-width: 150px;
  overflow: hidden;
  z-index: 1000;
}

.dropdown a {
  display: block;
  padding: 10px;
  color: #f5f5f5;
  text-decoration: none;
  font-weight: bold;
}

.dropdown a:hover {
  background-color: #66b3ff;
  color: #0b0c10;
}

/* When hamburger clicked */
.show {
  display: block;
}
  

  h1 {
    text-align: center;
    color: #70c041;
    margin-bottom: 20px;
  }

  /* ===== WIDER FULL-WIDTH LAYOUT WITHOUT BOX ===== */
  .profile-container {
    width: 100%;
    max-width: 900px;     /* wider but still readable */
    margin: 0 auto;
    padding: 20px 10px;    /* no border box */
    border: none;
    border-radius: 0;
    box-shadow: none;
    background: transparent;
  }

  /* move back-button to top */
  .back-btn {
    display: block;
    width: fit-content;
    margin: 0 auto 25px auto; /* center it */
    background-color: #66b3ff;
    color: white;
    font-weight: bold;
    text-decoration: none;
    padding: 10px 20px;
    border-radius: 6px;
    text-align: center;
  }

  .back-btn:hover {
    background-color: #70c041;
    color: #0b0c10;
  }

  label {
    display: block;
    margin-top: 15px;
    font-weight: bold;
    color: #66b3ff;
  }

  input {
    width: 100%;
    padding: 10px;
    margin-top: 5px;
    border: 2px solid #66b3ff;
    border-radius: 6px;
    background-color: #0b0c10;
    color: #f5f5f5;
    font-size: 1em;
  }

  .points-box {
    margin-top: 10px;
    padding: 12px;
    border-radius: 6px;
    background-color: #132235;
    border: 1px solid #70c041;
    color: #70c041;
    font-weight: bold;
    text-align: center;
    max-width: 300px;  /* prevent stretching */
    margin-left: auto;
    margin-right: auto;
  }

  button {
    width: 100%;
    margin-top: 20px;
    padding: 10px;
    border: none;
    border-radius: 6px;
    background-color: #70c041;
    font-weight: bold;
    color: #0b0c10;
    cursor: pointer;
    transition: background 0.3s;
  }

  button:hover {
    background-color: #66b3ff;
    color: #fff;
  }

  .saved-section {
    margin-top: 30px;
  }

  .saved-section h2 {
    color: #70c041;
    margin-bottom: 10px;
    border-bottom: 1px solid #66b3ff;
    padding-bottom: 5px;
  }

  ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  li {
    background-color: #132235;
    border: 1px solid #66b3ff;
    padding: 10px;
    margin: 5px 0;
    border-radius: 6px;
  }

  /* smaller right-aligned unsave button */
  .unsave-btn {
    padding: 6px 14px;
    background: #ff4d4d;
    color: white;
    font-weight: bold;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: 0.25s ease-in-out;
    font-size: 0.85em;
    width: fit-content;
    min-width: 70px;
    text-align: center;
    box-shadow: 0px 0px 6px rgba(255, 77, 77, 0.4);
  }

  .unsave-btn:hover {
    background: #ff6666;
    box-shadow: 0px 0px 10px rgba(255, 102, 102, 0.6);
  }
</style>


</head>

<body>

  <header class="simple-header">
  <img src="images/saselogo.webp" class="sase-logo" />

  <div class="header-right">
    <h1>Your Profile</h1>
    <a href="index.html" class="back-btn" style="margin-top:15px; margin-bottom:20px;">
      ← Back to Dashboard
    </a>

    <div class="menu-container">
      <button class="hamburger" onclick="toggleMenu()">☰</button>
      <div id="dropdownMenu" class="dropdown">
        <a href="profile.html">Edit Profile</a>
        <a href="#" onclick="logout()">Logout</a>
      </div>
    </div>
  </div>
</header>


  <div class="profile-container">

    <div id="pointsDisplay" class="points-box">
      Loading points...
    </div>

    <label for="firstName">First Name</label>
    <input type="text" id="firstName" />

    <label for="lastName">Last Name</label>
    <input type="text" id="lastName" />

    <label for="email">Email</label>
    <input type="email" id="email" />

    <label for="linkedin">LinkedIn</label>
    <input type="url" id="linkedin" />

    <button onclick="saveProfile()">Save Changes</button>

    <!-- SAVED PROFESSORS -->
    <div class="saved-section">
      <h2>Saved Professors</h2>
      <ul id="savedProfessors">
        <li>Loading...</li>
      </ul>
    </div>

    <!-- SAVED INTERNSHIPS -->
    <div class="saved-section">
      <h2>Saved Internships</h2>
      <ul id="savedInternships">
        <li>Loading...</li>
      </ul>
    </div>
    <!-- SAVED ALUMNI -->
    <div class="saved-section">
      <h2>Saved Alumni</h2>
      <ul id="savedAlumni">
        <li>Loading...</li>
      </ul>
    </div>

  </div>

  <script>
    const uh_id = localStorage.getItem("uh_id");
    if (!localStorage.getItem("loggedIn") || !uh_id) {
      window.location.href = "login.html";
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadProfile();
      loadSavedProfessors();
      loadSavedInternships();
      loadSavedAlumni(); 
    });

    async function loadProfile() {
      try {
        const res = await fetch(`/get-profile?uh_id=${uh_id}`);
        const data = await res.json();

        if (data.user) {
          document.getElementById("firstName").value = data.user.first_name || "";
          document.getElementById("lastName").value = data.user.last_name || "";
          document.getElementById("email").value = data.user.email || "";
          document.getElementById("linkedin").value = data.user.linkedin || "";

          const points = data.user.memberPoints ?? 0;
          document.getElementById("pointsDisplay").textContent =
            `Points: ${points}`;
        }
      } catch (err) {
        console.error("❌ Error loading profile:", err);
      }
    }

    function toggleMenu() {
  document.getElementById("dropdownMenu").classList.toggle("show");
}

window.onclick = function (event) {
  if (!event.target.matches(".hamburger")) {
    const menu = document.getElementById("dropdownMenu");
    if (menu) menu.classList.remove("show");
  }
};

  function logout() {
    localStorage.clear();
    window.location.href = "/login.html";
  }

    async function saveProfile() {
      const profileData = {
        uh_id,
        first_name: document.getElementById("firstName").value.trim(),
        last_name: document.getElementById("lastName").value.trim(),
        email: document.getElementById("email").value.trim(),
        linkedin: document.getElementById("linkedin").value.trim()
      };

      try {
        const res = await fetch("/update-profile", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(profileData)
        });

        const data = await res.json();
        alert(data.message || "Profile updated successfully!");
      } catch (err) {
        console.error("❌ Error saving profile:", err);
      }
    }

    /* ============================
       LOAD SAVED PROFESSORS
    ============================ */
    async function loadSavedProfessors() {
      const list = document.getElementById("savedProfessors");

      try {
        const res = await fetch(`/saved-professors/${uh_id}`);
        const professors = await res.json();

        if (!professors.length) {
          list.innerHTML = "<li>No saved professors yet</li>";
          return;
        }

        list.innerHTML = professors
          .map(
            p => `
              <li style="display:flex; align-items:flex-start; justify-content:space-between; gap:12px;">
                
                <div style="display:flex; align-items:flex-start; gap:12px; width:100%;">
                  <img 
                    src="${p.profile_pic_url || 'images/default_professor.png'}"
                    style="width:60px;height:60px;border-radius:8px;border:1px solid #70c041;object-fit:cover;"
                  />
                  
                <div style="flex:1;">
                  <strong>${p.professor_name}</strong><br>
                  <span>Majors: ${p.majors || "None"}</span><br>
                  <span>Email: ${p.email || "No email listed"}</span><br>

                  <div style="margin-top:6px;">
                    <span style="font-weight:bold;color:#70c041;">Bio:</span><br>
                    <span style="font-size:0.9em;color:#cccccc;line-height:1.3;">
                      ${p.description || "No bio available."}
                    </span>
                  </div>
                </div>   
             </div>

                <button class="unsave-btn" onclick="confirmUnsave(${p.id})">
                  Unsave
                </button>

              </li>
            `
          )
          .join("");
      } catch (err) {
        console.error("❌ Error loading saved professors:", err);
        list.innerHTML = "<li>Error loading saved professors</li>";
      }
    }

    function confirmUnsave(id) {
      const ok = confirm("Are you sure you want to unsave this professor?");
      if (ok) unsaveProfessor(id);
    }

    async function unsaveProfessor(professorId) {
      try {
        await fetch("/saved-professors/remove", {
          method: "DELETE",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ uh_id, professor_id: professorId })
        });

        loadSavedProfessors();
      } catch (err) {
        console.error("❌ Error unsaving professor:", err);
      }
    }

    /* ============================
       LOAD SAVED ALUMNI
============================ */
    async function loadSavedAlumni() {
      const list = document.getElementById("savedAlumni");

      try {
        const res = await fetch(`/saved-alumni/${uh_id}`);
        const alumni = await res.json();

        if (!alumni.length) {
          list.innerHTML = "<li>No saved alumni yet</li>";
          return;
        }

        list.innerHTML = alumni
          .map(
            a => `
              <li style="display:flex; align-items:flex-start; justify-content:space-between; gap:12px;">
                
                <div style="display:flex; align-items:flex-start; gap:12px; width:100%;">
                  <img 
                    src="${a.profile_pic || 'images/default_alumni.png'}"
                    style="width:60px;height:60px;border-radius:8px;border:1px solid #70c041;object-fit:cover;"
                  />

                  <div style="flex:1;">
                    <strong>${a.full_name}</strong><br>
                    <span>Company: ${a.company}</span><br>
                    <span>Role: ${a.role_title}</span><br>
                    <span>Email: ${a.email}</span><br>
                    <span>Industries: ${a.industries || "None"}</span>
                  </div>
                </div>

                <button class="unsave-btn" onclick="confirmUnsaveAlumni(${a.id})">
                  Unsave
                </button>
              </li>
            `
          )
          .join("");
      } catch (err) {
        console.error("❌ Error loading saved alumni:", err);
        list.innerHTML = "<li>Error loading saved alumni</li>";
      }
    }

    function confirmUnsaveAlumni(id) {
      const ok = confirm("Unsave this alumni?");
      if (ok) unsaveAlumni(id);
    }

    async function unsaveAlumni(alumni_id) {
      try {
        await fetch("/saved-alumni/remove", {
          method: "DELETE",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ uh_id, alumni_id })
        });

        loadSavedAlumni();
      } catch (err) {
        console.error("❌ Error unsaving alumni:", err);
      }
    }

    /* ============================
       LOAD SAVED INTERNSHIPS
    ============================ */
    async function loadSavedInternships() {
      const list = document.getElementById("savedInternships");

      try {
        const res = await fetch(`/saved-internships/${uh_id}`);
        const internships = await res.json();

        if (!internships.length) {
          list.innerHTML = "<li>No saved internships yet</li>";
          return;
        }

        list.innerHTML = internships
          .map(i => `<li><strong>${i.company}</strong> - ${i.title}</li>`)
          .join("");
      } catch (err) {
        console.error("❌ Error loading saved internships:", err);
        list.innerHTML = "<li>Error loading saved internships</li>";
      }
    }
  </script>
</body>
</html>